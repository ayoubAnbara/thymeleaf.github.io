<!DOCTYPE html>
<html>

  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Thymeleaf Page Layouts - Thymeleaf: java XML/XHTML/HTML5 template engine</title>
    <link rel="stylesheet" type="text/css" media="all" href="css/thymeleaf.css" />
    <link rel="shortcut icon" href="http://www.thymeleaf.org/favicon.ico" />
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

      <style type="text/css">
          /* ---------------------- */
          /* STYLE FOR IMAGES       */
          /* ---------------------- */
          #content img {
              display: block;
              margin-left: auto;
              margin-right: auto;
          }
      </style>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1276954-9']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script type="text/javascript" src="sh/scripts/shCore.js"></script>
    <script type="text/javascript" src="sh/scripts/shBrushXml.js"></script>
    <script type="text/javascript" src="sh/scripts/shBrushJava.js"></script>
    <link href="sh/styles/shCore.css" rel="stylesheet" type="text/css" />
    <link href="sh/styles/shThemeThymeleaf.css" rel="stylesheet" type="text/css" />
  </head>


  <body lang="en" dir="ltr">

  <div id="page">

  
   <div id="menu">
     <ul>
       <li><a href="index.html" title="Home">Home</a></li>
       <li><a href="features.html" title="Features">Features</a></li>
       <li><a href="download.html" title="Download">Download</a></li>
       <li><a href="documentation.html" title="Documentation">Documentation</a></li>
       <li><a href="ecosystem.html" title="Ecosystem">Ecosystem</a></li>
       <li><a href="http://forum.thymeleaf.org" title="User Forum">User Forum</a></li>
       <li><a href="issuetracking.html" title="Issue Tracking">Issue Tracking</a></li>
     </ul>
   </div>

   <div id="header">
     <a href="index.html" title="Thymeleaf home"><img src="images/thymeleaflogonameverysmall.png" class="logo" alt="Thymeleaf Template Engine"/></a>
   </div>

   <div id="breadcrumb">
      <a href="index.html">thymeleaf</a>
      ::
      <a href="documentation.html">documentation</a> 
      :: 
      articles
      ::
      <span class="current">thymeleaf page layouts</span>
   </div>


   <div id="content">

     <h1>Thymeleaf Page Layouts</h1>

     <p id="author">
       <i>By Rafa&#322; Borowiec &lt;rafal.borowiec AT gmail.com&gt;</i>
     </p>



     <h2>Introduction</h2>

     <p>
         Usually websites share common page components like the header, footer, menu and possibly many more.
         These page components can be used by the same or different layouts. There are two main styles of
         organizing layouts in projects: <em>include</em> style and <em>hierarchical</em> style. Both styles can be easily
         utilized with Thymeleaf without losing its biggest value: <strong>natural templating</strong>.
     </p>
     
     <h3>Include-style layouts</h3>

     <p>
         In this style pages are built by embedding common page component code directly within each view to
         generate the final result. In Thymeleaf this can be done using <strong>Thymeleaf Standard Layout System</strong>:
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
         <body>
           <div th:include="footer :: copy"></div>
         </body>
    ]]></script>

     <p>
         The include-style layouts are pretty simple to understand and implement and in fact they offer flexibility
         in developing views, which is their biggest advantage. The main disadvantage of this solution, though, is
         that some code duplication is introduced so modifying the layout of a large number of views in big
         applications can become a bit cumbersome.
     </p>

     <h3>Hierarchical-style layotus</h3>

     <p>
         In hierarchical style, the templates are usually created with a parent-child relation, from the more
         general part (layout) to the most specific ones (subviews; e.g. page content). Each component of the
         template may be included dynamically based on the inclusion and substitution of template fragments. In
         Thymeleaf this can be done using: <strong>Thymeleaf Layout Dialect</strong> and
         <strong>Thymeleaf Tiles Integration</strong>.
     </p>

     <p>
         The main advantages of this solution are the reuse of atomic portions of the view and modular design,
         whereas the main disadvantage is that much more configuration is needed in order to use them, so the
         complexity of the views is bigger than with Include Style Layouts which are more "natural" to use.
     </p>



     <h2>Example Application</h2>

     <p>
         All the samples and code fragments presented in this article are available on GitHub at
         <a target="_blank"
            href="https://github.com/thymeleaf/thymeleafexamples-layouts">https://github.com/thymeleaf/thymeleafexamples-layouts</a>
     </p>



     <h2>Thymeleaf Standard Layout System</h2>

     <p>
         Thymeleaf Standard Layout System offers page fragment inclusion that is similar to <em>JSP includes</em>,
         with some important improvements over them:
     </p>


     <h3>Basic inclusion with <kbd>th:include</kbd> and <kbd>th:replace</kbd></h3>

     <p>
         Thymeleaf can include parts of other pages as fragments (whereas JSP only includes complete pages)
         using <kbd>th:include</kbd> (will include the contents of the fragment into its host tag) or `th:replace` (will actually substitute the host tag by the fragment's). This allows the grouping of fragments into one or several pages. Look at the example. The `home/homeNotSignedIn.html` template is rendered when the anonymous user enters the home page of our application.
     </p>

     <p>
         <kbd>/main/java/thymeleafexamples/layouts/home/HomeController.java</kbd>
     </p>

     <script type="syntaxhighlighter" class="brush:java"><![CDATA[
         @Controller
         public class HomeController {

             @RequestMapping(value = "/", method = RequestMethod.GET)
             public String index(Principal principal) {
                return principal != null ? "home/homeSignedIn" : "home/homeNotSignedIn";
             }

         }
     ]]></script>

     <p>
         <kbd>home/homeNotSignedIn.html</kbd>
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
         <!DOCTYPE html>
         <html>
           <head>
             ...
           </head>
           <body>
             ...
             <div th:replace="fragments/header :: header">
               <!-- ============================================================================ -->
               <!-- This content is only used for static prototyping purposes (natural templates)-->
               <!-- and is therefore entirely optional, as this markup fragment will be included -->
               <!-- from "fragments/header.html" at runtime.                                     -->
               <!-- ============================================================================ -->
               <div class="navbar navbar-inverse navbar-fixed-top">
                 <div class="container">
                   <div class="navbar-header">
                     <a class="navbar-brand" href="#">Static header</a>
                   </div>
                   <div class="navbar-collapse collapse">
                     <ul class="nav navbar-nav">
                       <li class="active"><a href="#">Home</a></li>
                     </ul>
                   </div>
                 </div>
               </div>
             </div>
             <div class="container">
               <div class="hero-unit">
                 <h1>Test</h1>
                 <p>
                   Welcome to the Spring MVC Quickstart application!
                   Get started quickly by signing up.
                 </p>
                 <p>
                   <a href="/signup" th:href="@{/signup}" class="btn btn-large btn-success">Sign up</a>
                 </p>
               </div>
               <div th:replace="fragments/footer :: footer">&copy; 2013 The Static Templates</div>
             </div>
             ...
           </body>
         </html>
     ]]></script>


     <p>
         You can open the file directly in a browser:
     </p>

     <img src="images/layouts_homeNotSignedIn.png" alt="Home page when not signed in"/>

     <p>
         In the above example, we are building a page that consists of page header and page footer. In
         Thymeleaf all fragments can be defined in a single file (e.g. <kbd>fragments.html</kbd>) or in a
         separate files, like in this particular case.
     </p>

     <p>
         Let's shortly analyze the inclusion statement:
     </p>

     <script type="syntaxhighlighter" class="brush:xml;gutter:false"><![CDATA[
       <div th:replace="fragments/header :: header">...</div>
     ]]></script>

     <p>
         The first part of the statement, <kbd>fragments/header</kbd>, is a template name that we are referencing.
         This can be a file (like in this example) or it can reference to the same file either by using the
         <kbd>this</kbd> keyword (e.g. <kbd>this :: header</kbd>) or without any keyword (e.g.
         <kbd>:: header</kbd>). The expression after double colon is a fragment selector (either fragment name
         or <em>DOM selector</em>). As you can see also see, the header fragment contains a markup that is used
         for static prototyping only.
    </p>

     <p>
         Header and footer are defined in the following files:
     </p>

     <p>
         <kbd>fragments/header.html</kbd>
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
        <!DOCTYPE html>
        <html>
          <head>
            ...
          </head>
          <body>
            <div class="navbar navbar-inverse navbar-fixed-top" th:fragment="header">
              ...
            </div>
          </body>
        </html>
     ]]></script>

     <p>
         Note how that the referenced fragments are specified with <kbd>th:fragment</kbd> attributes. This way
         we can defined multiple fragments in one template file, as it was mentioned earlier.
     </p>

     <p>
         What is important here, is that all the templates are still natural templates and can be viewed in a
         browser without a running server.
     </p>


     <h3>Including with DOM Selectors</h3>

     <p>
         In Thymeleaf, fragments don't need to be explicitly specified using <kbd>th:fragment</kbd> at the
         page they are extracted from. Thymeleaf can select any fragment of any page as a fragment (even a
         page living on an external server) by means of its DOM Selector syntax, similar to XPath expressions
         and CSS selectors.
     </p>

     <script type="syntaxhighlighter" class="brush:xml;gutter:false"><![CDATA[
        <div th:include="http://www.thymeleaf.org :: p.notice" />
     ]]></script>

     <p>
         The above code will include a paragraph with <kbd>class="notice"</kbd> from
         <kbd>thymeleaf.org</kbd>. In order to make it happen, the template engine must be configured
         with <kbd>UrlTemplateResolver</kbd>:
     </p>

     <script type="syntaxhighlighter" class="brush:java"><![CDATA[
         @Bean
         public SpringTemplateEngine templateEngine() {
             SpringTemplateEngine templateEngine = new SpringTemplateEngine();
             templateEngine.addTemplateResolver(templateResolver());
             templateEngine.addTemplateResolver(urlTemplateResolver());
             templateEngine.addDialect(new SpringSecurityDialect());
             return templateEngine;
         }
     ]]></script>

     <p>
         For the DOM Selector syntax reference checkout this section in Thymeleaf documentation:
         <a target="_blank"
            href="http://www.thymeleaf.org/doc/html/Using-Thymeleaf.html#appendix-c-dom-selector-syntax">DOM Selector syntax</a>.
     </p>


     <h3>Using expressions</h3>

     <p>
         In <kbd>templatename :: domselector</kbd>, both <kbd>templatename</kbd> and
         <kbd>domselector</kbd> can be fully-featured expressions. In the below example we want to include
         different fragments depending on a condition. If the authenticated user is an Admin, we will show a different footer than for a regular user:
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
        <div th:replace="fragments/footer :: ${#authentication.principal.isAdmin()} ? 'footer-admin' : 'footer'">
          &copy; 2013 The Static Templates
        </div>
     ]]></script>

     <p>
         <kbd>fragments/footer.html</kbd> has slightly changed, as we need to have two footers defined:
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
         <!DOCTYPE html>
         <html>
           <head>
             ...
           </head>
           <body>
             <!-- /*  Multiple fragments may be defined in one file */-->
             <div th:fragment="footer">
               Content of a regular footer goes here
             </div>
             <div th:fragment="footer-admin">
               Content of an admin footer goes here
             </div>
           </body>
         </html>
     ]]></script>



     <h3>Parameterized inclusion</h3>

     <p>
         Fragments can specify arguments, just like methods. Whenever they are explicitly specified
         with a <kbd>th:fragment</kbd> attribute, they can provide an argument signature that can then be
         filled in with arguments from the calling <kbd>th:include</kbd> or <kbd>th:replace</kbd> attributes.
     </p>

     <p>
         Examples talk best. We can use parameterized inclusion in many contexts but one real life context
         is displaying messages on different pages of our application after successful form submission. Let's
         look at the signup process in the application:
     </p>

     <script type="syntaxhighlighter" class="brush:java"><![CDATA[
        @RequestMapping(value = "signup", method = RequestMethod.POST)
        public String signup(@Valid @ModelAttribute SignupForm signupForm,
                             Errors errors, RedirectAttributes ra) {

            if (errors.hasErrors()) {
                return SIGNUP_VIEW_NAME;
            }
            Account account = accountRepository.save(signupForm.createAccount());
            userService.signin(account);
            // see /WEB-INF/i18n/messages.properties and /WEB-INF/views/homeSignedIn.html
            MessageHelper.addSuccessAttribute(ra, "signup.success");

            return "redirect:/";

        }
     ]]></script>

     <p>
         As you can see, after a successful signup the user will be redirected to the home page with a
         flash attribute filled in. We want to create a reusable and parameterized fragment. This can be
         done as follows:
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
        <!DOCTYPE html>
        <html>
          <head>
            ...
          </head>
          <body>
            <div th:fragment="alert (type, message)"
                 class="alert alert-dismissable" th:classappend="'alert-' + ${type}">
              <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
              <span th:text="${message}">Test</span>
            </div>
          </body>
        </html>
     ]]></script>

     <p>
         The above <kbd>alert</kbd> fragment takes two arguments: <kbd>type</kbd> and <kbd>message</kbd>. The
         <kbd>type</kbd> is the message type used for styling a message whereas the <kbd>message</kbd> is a text
         that will be shown to the user. If we wanted, we could have even ensured that arguments existed or met
         certain conditions using a <kbd>th:assert</kbd> attribute.
     </p>

     <p>
         In order to include <kbd>alert</kbd> in any template we may write the following code (please note,
         that the value of a variable can be an expression):
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
        <div th:replace="fragments/alert :: alert (type='danger', message=${errorMessage})">...</div>
     ]]></script>

     <p>
         Parameterized fragments let developers create functional-like fragments that are easier to reuse. Read
         more about parameterized fragments in the Thymeleaf documentation:
         <a target="_blank"
            href="http://www.thymeleaf.org/doc/html/Using-Thymeleaf.html#parameterizable-fragment-signatures">Parameterizable fragment signatures</a>.
     </p>


     <h3>Fragment inclusion from Spring <kbd>@Controller</kbd></h3>

     <p>
         Fragments can be directly specified from a Spring MVC controller, i.e.
         <kbd>signup :: signupForm</kbd>; which can be useful for AJAX controllers that return only a
         small fragment of HTML to the browser. In the example below, the signup form fragment will be loaded
         upon AJAX request and the whole signup view - on regular request:
     </p>

     <script type="syntaxhighlighter" class="brush:java"><![CDATA[
         @RequestMapping(value = "signup")
         public String signup(Model model,
                              @RequestHeader("X-Requested-With") String requestedWith) {
             model.addAttribute(new SignupForm());
             if (AjaxUtils.isAjaxRequest(requestedWith)) {
                 return SIGNUP_VIEW_NAME.concat(" :: signupForm");
             }
             return SIGNUP_VIEW_NAME;
         }
     ]]></script>

     <p>
         The fragment is defined in <kbd>/WEB-INF/views/signup/signup.html</kbd>:
     </p>

     <script type="syntaxhighlighter" class="brush:xml"><![CDATA[
         <!DOCTYPE html>
         <html>
           <head>
             ...
           </head>
           <body>
           <form method="post"
                 th:action="@{/signup}" th:object="${signupForm}" th:fragment="signupForm">
             ...
           </form>
           </body>
         </html>
     ]]></script>

     <p>
         The above fragment is loaded when a new user wants to signup from a home page. The modal dialog
         will be shown upon clicking <kbd>Signup</kbd> button and the content will be loaded via AJAX call (see
         <kbd>/WEB-INF/views/home/homeNotSignedIn.html</kbd>).
     </p>



     <h3>References</h3>

     <p>
         Please check Thymeleaf documentation that describes this topic very thoroughly. You can find it
         here: <a target="_blank"
                  href="http://www.thymeleaf.org/doc/html/Using-Thymeleaf.html#template-layout">Template Layout</a>.
     </p>

     <p>
         Natural templating is greatly explained in
         <a target="_blank" href="http://www.thymeleaf.org/petclinic.html">Bringing Thymeleaf and Natural
             Templates to the Spring PetClinic</a> article in <kbd>And what about the Natural Templates thing?</kbd>
         chapter. The example can be found on
         <a href="https://github.com/thymeleaf/thymeleafexamples-petclinic/blob/thymeleafexamples-petclinic-20131104/src/main/webapp/WEB-INF/thymeleaf/owners/ownersList.html">GitHub</a>.
     </p>


     <h3>Thymol</h3>

     <p>
         When a Thymeleaf template is used as a static prototype, we cannot see the fragments we are including
         using the <kbd>th:include/th:replace</kbd> host tags. We can only see the fragments aside, opening
         their own template documents.
     </p>

     <p>
         However, there is a way to see the real fragments included into our pages while prototyping. This
         can be done using <a href="http://www.thymeleaf.org/ecosystem.html#thymol">Thymol</a>, an unofficial
         JavaScript library that is an implementation of Thymeleaf's standard fragment inclusion functionality,
         providing static support for some Thymeleaf  attributes like <kbd>th:include</kbd> or
         <kbd>th:replace</kbd>, conditional display with <kbd>th:if</kbd>/<kbd>th:unless</kbd>, etc.
     </p>

     <p>
         As Thymol's author states:
     </p>

     <p><em>
         Thymol was created in order to provide a more accurate static representation of Thymeleaf's dynamic
         templating capabilities by offering support for Thymeleaf attributes through a statically accessible
         javascript library
     </em></p>

     <p>
         Thymol documentation and examples can be found on the official project site here:
         <a target="_blank" href="http://sourceforge.net/u/jjbenson/wiki/thymol/">Thymol at SourceForge.net</a>.
     </p>


   </div>
   
   
   <div id="footer">
     <div id="googleplus">
       <div id="plusone-div" class="plusone"></div>
       <script type="text/javascript">
           gapi.plusone.render('plusone-div',{"size": "small", "count": "true", "href": "http://www.thymeleaf.org"});
       </script>
     </div>
     <div id="twitter">
       <a href="http://twitter.com/thymeleaf" class="twitter-follow-button" data-show-count="false">Follow @thymeleaf</a>
       <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
     </div>
     <div id="copy">
       Copyright &copy; The <a href="team.html">THYMELEAF Team</a>. See <a href="documentation.html">applicable licenses</a>.
     </div>
   </div>
   
  </div>

  <script type="text/javascript">
      SyntaxHighlighter.all();
  </script>

  </body>
  
</html>